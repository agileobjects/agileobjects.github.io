(function(n){(function(t){var i=function(){function t(){var t=this;this.possibles=[];this.currentIndex=0;this.image=n.get("avatar-preview");this.imageDefault=this.image.src;this.image.onerror=function(){t.tryLoad(!0)}}return t.prototype.load=function(n){this.possibles=this.buildPossibles(n.value);this.currentIndex=0;this.tryLoad()},t.prototype.buildPossibles=function(t){var i=[];return n.isEmail(t)?i.push("https://secure.gravatar.com/avatar/"+md5(t)+"?s=50&d=identicon&r=pg"):(i.push("https://github.com/"+t+".png?size=50"),i.push("https://avatars.io/twitter/"+t+"/medium")),i},t.prototype.tryLoad=function(n){if(n&&++this.currentIndex,this.currentIndex<this.possibles.length){this.image.src=this.possibles[this.currentIndex];return}this.image.onerror=null;this.image.src=this.imageDefault},t}(),r=function(){function t(){this.avatar=new i;this.comment=n.get("comment");this.name=n.get("name");this.identity=n.get("identity");this.email=n.get("email");this.rememberMe=n.get("remember")}return t.prototype.load=function(){var n=this;this.identity.onchange=function(){n.avatar.load(this)};this.retrieveUser();this.identity.value&&this.avatar.load(this.identity)},t.prototype.retrieveUser=function(){var n=!1;window.localStorage.name&&(this.name.value=window.localStorage.name,n=!0);window.localStorage.identity&&(this.identity.value=window.localStorage.identity,n=!0);n&&(this.rememberMe.checked=!0)},t.prototype.storeUser=function(n,t){window.localStorage.name=n;window.localStorage.identity=t},t.prototype.handlePost=function(t){var i=n.form(t),r;return!i.validate()||!i.submit.confirm()?!1:(i.submitting(),this.rememberMe.checked?this.storeUser(this.name.value,this.identity.value):this.storeUser("",""),r={postId:n.get("post-id").value,message:this.comment.value,name:this.name.value,avatar:this.avatar.image.src},n.isEmail(this.identity.value)&&(r.email=this.identity.value),n.ajax({type:"post",url:t.action,data:r,ctx:i,onFail:function(){this.error()},onSuccess:function(){this.ok()}}),!1)},t.prototype.handlePosted=function(t){t&&(this.comment.value="");n.form().reset()},t}();n(function(){t.commentForm=new r;t.commentForm.load()})})(n.Web||(n.Web={}))})(Ao);